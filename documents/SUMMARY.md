# ゲスタロカ (GESTALOKA) プロジェクトサマリー

## 概要
**ゲスタロカ**は、LLMとグラフDB/RDBを組み合わせたマルチプレイ・テキストMMOです。プレイヤーの行動履歴（ログ）が他プレイヤーの世界にNPCとして影響を与える、動的な物語生成システムを特徴としています。

## 技術スタック
- **フロントエンド**: TypeScript, React 19, Vite, shadcn/ui, zustand, TanStack Query/Router
- **バックエンド**: Python 3.11, FastAPI, LangChain, SQLModel, neomodel, Celery
- **データベース**: PostgreSQL 17, Neo4j 5.26 LTS, Redis 8
- **AI/LLM**: Gemini 2.5 Pro, GM AI評議会（6つの専門AI）
- **認証**: Keycloak 26.2

## 実装状況
✅ **完了**: 認証システム、キャラクター管理、ゲームセッション、AI統合基盤、GM AI評議会（全6エージェント）、WebSocket通信、戦闘システム、Alembic統合、ログ編纂機能、SPシステム、ログ派遣システム（AI駆動シミュレーション含む）、探索システム、ログNPC出現システム（フロントエンド改善版・2025/06/29完了）、SP購入システム（Stripe統合・2025/07/01完了）、探索システムミニマップ（Phase 1-4完了・2025/07/01）、ログフラグメント発見メカニクス強化（2025/07/01）、物語主導型移動システム（2025/07/01）、SPサブスクリプション（2025/07/02）、管理画面SPシステム（2025/07/02）、ログ遭遇システム強化（2025/07/02）、コード品質改善（テスト100%成功、リント0エラー・2025/07/02）  
🚧 **進行中**: 本番環境向けStripe設定  
📋 **計画中**: ログ編纂システムの拡張、戦闘システムのスキル・アビリティ、ミニマップのモバイル対応・アクセシビリティ、記憶継承システム

## 現在の優先タスク
1. 本番環境向けStripe設定の最終化
2. 記憶継承システムの実装
3. 遭遇結果の永続化と履歴管理
4. TypeScriptのany型改善（技術的債務の解消）

## ドキュメント構成

### [01_project/](01_project/summary.md) - プロジェクト管理
MVP要件、進捗追跡、現在のタスク管理

### [02_architecture/](02_architecture/summary.md) - アーキテクチャ
システム設計、技術選定、API仕様

### [03_worldbuilding/](03_worldbuilding/summary.md) - 世界観
階層世界『ゲスタロカ』の設定、ゲームメカニクス

### [04_ai_agents/](04_ai_agents/summary.md) - AIエージェント
GM AI評議会の各エージェント仕様

### [05_implementation/](05_implementation/summary.md) - 実装ガイド
機能実装のサマリー、トラブルシューティング

### [06_reports/](06_reports/summary.md) - レポート
テストプレイレポート、フィードバック

## 最近の更新（2025年7月）

### SPサブスクリプション機能（2025/07/02）
- 月額課金プラン（Basic/Premium）の実装
- Stripe統合による安全な決済処理
- サブスクリプション自動更新・期限管理
- 日次SPボーナス（Basic: +20SP/日、Premium: +50SP/日）

### 管理画面SPシステム（2025/07/02）
- 管理者によるSP付与・調整機能
- プレイヤーSP残高の一覧・検索
- SP取引履歴の確認
- イベント配布・バグ補填用の一括調整API

### ログフラグメント発見メカニクスの強化（2025/07/01）
- 125種類以上の日本語キーワード実装
- 場所タイプとレアリティに応じた動的生成
- 物語主導の行動からの自動フラグメント生成
- フロントエンド管理UI（統計情報、フィルタリング機能）

### 物語主導型移動システム（2025/07/01）
- ゲーム的な直接移動から物語体験重視へ移行
- ミニマップはview-onlyモードに変更
- 行動選択→GM AI物語生成→自然な場所移動の流れ

### ログ遭遇システム強化（2025/07/02）
- 動的な遭遇確率システム（目的タイプ・性格・汚染度による計算）
- 複数NPC同時遭遇のサポート（最大3体、タブ形式UI）
- アイテム交換システム（価値バランス計算、交換プレビュー）
- フロントエンドUI完全実装（NPCEncounterManager、ItemExchangeDialog）

### コード品質の大幅改善（2025/07/02）
- バックエンドテスト229個全て成功（100%成功率）
- リントエラー完全解消（バックエンド0個）
- 型エラーの大幅削減（60個→38個、Stripe関連を除く内部コードは0個）
- フロントエンドの主要エラー修正（use-toast.tsx、MinimapCanvas.tsx等）
- SQLModelのField引数修正、async/await構文の修正