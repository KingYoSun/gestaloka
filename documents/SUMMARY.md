# ゲスタロカ (GESTALOKA) プロジェクトサマリー

最終更新: 2025-07-05

## 概要
**ゲスタロカ**は、LLMとグラフDB/RDBを組み合わせたマルチプレイ・テキストMMOです。プレイヤーの行動履歴（ログ）が他プレイヤーの世界にNPCとして影響を与える、動的な物語生成システムを特徴としています。

## 技術スタック
- **フロントエンド**: TypeScript, React 19, Vite, shadcn/ui, zustand, TanStack Query/Router
- **バックエンド**: Python 3.11, FastAPI, LangChain, SQLModel, neomodel, Celery
- **データベース**: PostgreSQL 17, Neo4j 5.26 LTS, Redis 8
- **AI/LLM**: Gemini 2.5 Pro（gemini-2.5-pro）, GM AI評議会（6つの専門AI）
- **認証**: Keycloak 26.2
- **決済**: Stripe（SPサブスクリプション）
- **インフラ**: Docker Compose, WebSocket

## 実装状況（2025/07/05時点）

### ✅ 完了済み機能
**基盤システム**: 認証（統一化済み）、キャラクター管理、ゲームセッション、WebSocket通信、Alembic統合  
**AI統合**: GM AI評議会（全6エージェント）、AIレスポンスキャッシュ（コスト20-30%削減）  
**ゲームシステム**: 戦闘、探索、ログ編纂、SPシステム（日次回復自動化済み）  
**ログ関連**: ログ派遣（AI駆動シミュレーション）、フラグメント発見（125種類以上）、遭遇システム（複数NPC対応）  
**高度な編纂メカニクス**: コンボボーナスシステム、汚染浄化メカニクス、特殊称号システム（完全実装済み）  
**記憶継承**: 動的クエストシステム、記憶継承メカニクス（スキル/称号/アイテム/ログ強化）  
**遭遇ストーリー**: 継続的な関係性構築、8種類のストーリーアーク、共同クエスト  
**フロントエンド**: ミニマップ（Phase 1-4）、物語主導型移動、認証システム統一、テスト100%成功  
**課金システム**: SP購入（Stripe統合）、SPサブスクリプション（Basic/Premium）  
**管理機能**: SP付与・調整、履歴管理  
**品質**: 全テスト成功（フロント47/47、バックエンド229/229）、リント0エラー、型エラー0件

### 🚧 進行中
- 本番環境向けStripe設定の最終化

### 📋 計画中
- 戦闘システムのスキル・アビリティ拡張
- パフォーマンス最適化とシステム監視体制構築

## 開発環境（2025/07/05時点）
- langchain-google-genai 2.1.6
- Pydantic V2完全移行済み
- AIレスポンスキャッシュ実装済み（コスト20-30%削減）
- フロントエンドテスト100%成功（47/47件）
- 全コード品質チェック通過（型・リント）
- SP日次回復の自動化実装済み（Celeryタスク、毎日UTC 4時実行）
- 記憶フラグメントを「ゲーム体験の記念碑」として再設計（2025/07/02）
- 高度な編纂メカニクス実装（コンボボーナス、汚染浄化、特殊称号）（2025/07/05完了）
- 認証システム統一（AuthProvider/useAuth）

## ドキュメント構成

### [01_project/](01_project/summary.md) - プロジェクト管理
MVP要件、進捗追跡、現在のタスク管理

### [02_architecture/](02_architecture/summary.md) - アーキテクチャ
システム設計、技術選定、API仕様

### [03_worldbuilding/](03_worldbuilding/summary.md) - 世界観
階層世界『ゲスタロカ』の設定、ゲームメカニクス

### [04_ai_agents/](04_ai_agents/summary.md) - AIエージェント
GM AI評議会の各エージェント仕様

### [05_implementation/](05_implementation/summary.md) - 実装ガイド
機能実装のサマリー、トラブルシューティング

### [06_reports/](06_reports/summary.md) - レポート
テストプレイレポート、フィードバック

## 最近の主要更新（2025年7月）

### コード品質の完全改善（2025/07/05）
- **Pydantic V2移行**: `@validator`→`@field_validator`、`.from_orm()`→`.model_validate()`
- **DRY原則**: トースト実装統一、型定義重複解消
- **テスト成功率100%**: フロントエンド47/47、バックエンド229/229
- **エラー0件達成**: 型チェック、リント完全クリア

### 認証・WebSocket修正（2025/07/05）
- **認証システム統一**: useAuthStore→AuthProvider/useAuthフックへ一本化
- **WebSocket接続状態**: 接続状態表示の問題を完全解決
- **レイアウト問題**: TanStack Routerレイアウトルートで二重表示解消
- **CORS問題**: 環境変数からの動的設定を維持しつつ根本解決

### 高度な編纂メカニクス完全実装（2025/07/05）
- **フロントエンドUI**: SP消費リアルタイム表示、コンボボーナス視覚化
- **浄化インターフェース**: 汚染度表示、浄化効果プレビュー、アイテム作成
- **特殊称号管理**: 称号一覧、装備機能、ゲーム画面での表示
- **完全な型安全性**: TypeScriptエラー0件達成
- **汚染概念の深化**: 負の感情による「コンテキスト汚染」として再定義（AI/LLMにも通じる概念）

### SPシステム完全実装（2025/07/02）
- **サブスクリプション**: Basic（+20SP/日）、Premium（+50SP/日）プラン
- **自動化**: 日次回復（UTC 4時）、期限管理、Stripe統合
- **管理機能**: SP付与・調整、履歴管理、一括調整API

### ログシステム強化（2025/07/01-02）
- **フラグメント**: 125種類以上のキーワード、動的生成
- **遭遇**: 複数NPC対応（最大3体）、確率計算、アイテム交換
- **物語主導**: 行動選択→GM AI生成→自然な移動の流れ

### 品質改善（2025/07/02）
- テスト229個全て成功、リント0エラー
- 型エラー大幅削減（60個→38個、内部コード0個）

### 記憶継承システム実装（2025/07/02）
- **動的クエスト**: AI駆動の自然なクエスト生成・進行管理
- **記憶継承メカニクス**: 4つの継承タイプ（スキル/称号/アイテム/ログ強化）
- **新モデル**: CharacterTitle、Item、CharacterItem、Skillモデル分離
- **SP消費**: レアリティとコンボボーナスによる動的価格設定