# ゲスタロカ (GESTALOKA) プロジェクトサマリー

最終更新: 2025-07-03

## 概要
**ゲスタロカ**は、LLMとグラフDB/RDBを組み合わせたマルチプレイ・テキストMMOです。プレイヤーの行動履歴（ログ）が他プレイヤーの世界にNPCとして影響を与える、動的な物語生成システムを特徴としています。

## 技術スタック
- **フロントエンド**: TypeScript, React 19, Vite, shadcn/ui, zustand, TanStack Query/Router
- **バックエンド**: Python 3.11, FastAPI, LangChain, SQLModel, neomodel, Celery
- **データベース**: PostgreSQL 17, Neo4j 5.26 LTS, Redis 8
- **AI/LLM**: Gemini 2.5 Pro（gemini-2.5-pro）, GM AI評議会（6つの専門AI）
- **認証**: Keycloak 26.2
- **決済**: Stripe（SPサブスクリプション）
- **インフラ**: Docker Compose, WebSocket

## 実装状況（2025/07/03時点）

### ✅ 完了済み機能
**基盤システム**: 認証、キャラクター管理、ゲームセッション、WebSocket通信、Alembic統合  
**AI統合**: GM AI評議会（全6エージェント）、AIレスポンスキャッシュ（コスト20-30%削減）  
**ゲームシステム**: 戦闘、探索、ログ編纂、SPシステム（日次回復自動化済み）  
**ログ関連**: ログ派遣（AI駆動シミュレーション）、フラグメント発見（125種類以上）、遭遇システム（複数NPC対応）  
**フロントエンド**: ミニマップ（Phase 1-4）、物語主導型移動、テスト100%成功（MSW導入）  
**課金システム**: SP購入（Stripe統合）、SPサブスクリプション（Basic/Premium）  
**管理機能**: SP付与・調整、履歴管理  
**品質**: 全テスト成功、リント0エラー、型エラー大幅削減

### 🚧 進行中
- 記憶継承システムの実装（設計完了、動的クエストシステム実装開始）
- 本番環境向けStripe設定の最終化

### 📋 計画中
- 動的クエストシステム（GM AIによる自然なクエスト生成）
- 遭遇結果の永続化と履歴管理
- 高度な編纂メカニクス（コンボボーナス、特殊称号）
- 戦闘システムのスキル・アビリティ拡張

## 開発環境（2025/07/03時点）
- langchain-google-genai 2.1.6
- AIレスポンスキャッシュ実装済み（コスト20-30%削減）
- フロントエンドテスト100%成功（MSW導入）
- 全コード品質チェック通過（型・リント）
- SP日次回復の自動化実装済み（Celeryタスク、毎日UTC 4時実行）
- 記憶フラグメントを「ゲーム体験の記念碑」として再設計（2025/07/03）

## ドキュメント構成

### [01_project/](01_project/summary.md) - プロジェクト管理
MVP要件、進捗追跡、現在のタスク管理

### [02_architecture/](02_architecture/summary.md) - アーキテクチャ
システム設計、技術選定、API仕様

### [03_worldbuilding/](03_worldbuilding/summary.md) - 世界観
階層世界『ゲスタロカ』の設定、ゲームメカニクス

### [04_ai_agents/](04_ai_agents/summary.md) - AIエージェント
GM AI評議会の各エージェント仕様

### [05_implementation/](05_implementation/summary.md) - 実装ガイド
機能実装のサマリー、トラブルシューティング

### [06_reports/](06_reports/summary.md) - レポート
テストプレイレポート、フィードバック

## 最近の主要更新（2025年7月）

### SPシステム完全実装（2025/07/02）
- **サブスクリプション**: Basic（+20SP/日）、Premium（+50SP/日）プラン
- **自動化**: 日次回復（UTC 4時）、期限管理、Stripe統合
- **管理機能**: SP付与・調整、履歴管理、一括調整API

### ログシステム強化（2025/07/01-02）
- **フラグメント**: 125種類以上のキーワード、動的生成
- **遭遇**: 複数NPC対応（最大3体）、確率計算、アイテム交換
- **物語主導**: 行動選択→GM AI生成→自然な移動の流れ

### 品質改善（2025/07/02）
- テスト229個全て成功、リント0エラー
- 型エラー大幅削減（60個→38個、内部コード0個）