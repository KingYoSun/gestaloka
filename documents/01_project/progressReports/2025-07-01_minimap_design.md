# 2025/07/01 ミニマップ機能設計

## 作業概要

探索システムのミニマップ機能について、詳細な設計と技術仕様を策定しました。

## 成果物

### 1. ミニマップ機能設計書
- **ファイル**: `documents/02_architecture/features/minimap_design.md`
- **内容**:
  - 基本コンセプト（段階的開示、階層別表示、インタラクティブ性）
  - 技術アーキテクチャ（バックエンド/フロントエンド拡張）
  - UI/UXデザイン（表示モード、視覚要素、アニメーション）
  - パフォーマンス最適化戦略
  - 実装フェーズ計画（4週間）

### 2. 技術仕様書
- **ファイル**: `documents/02_architecture/features/minimap_technical_spec.md`
- **内容**:
  - 詳細なAPI仕様
  - データベーススキーマ設計
  - Canvas描画アーキテクチャ
  - 霧効果（Fog of War）実装
  - 状態管理（Zustand）
  - エラーハンドリング
  - テスト仕様
  - 移行計画

## 設計のハイライト

### 1. 多層Canvas構造
パフォーマンス最適化のため、5つのレイヤーに分離：
- background: 静的な背景
- locations: 場所アイコン
- connections: 接続線
- fog: 霧効果
- overlay: プレイヤー位置、エフェクト

### 2. 探索進捗管理
新規テーブル`character_exploration_progress`で、各キャラクターの探索状況を詳細に記録：
- 探索パーセンテージ（0-100%）
- 霧が晴れた時刻
- 完全探索時刻
- 探索済みエリアリスト

### 3. インタラクティブ機能
- ズーム/パン操作
- クリックによる詳細表示
- キーボードショートカット（Mキーで拡張表示）
- 自動フォーカス（現在地追従）

### 4. 視覚デザイン
- アイコンによる場所タイプの識別
- 色彩による探索状態の表現
- スムーズなアニメーション効果
- ゲーム世界観を損なわないビジュアル

## 技術的な特徴

### 1. パフォーマンス最適化
- 視錐台カリング
- LOD（Level of Detail）システム
- ダーティーリージョン管理
- レイヤーキャッシング

### 2. リアルタイム更新
- WebSocketによる探索進捗の即時反映
- 差分更新による通信量削減
- IndexedDBによるローカルキャッシュ

### 3. 拡張性
- 将来的な機能追加を考慮した設計
- マップマーキング
- 経路探索
- 共有マップ機能

## 実装スケジュール

1. **Phase 1**: 基礎実装（1週間）
   - バックエンドAPI
   - 基本Canvas描画
   - 現在地表示

2. **Phase 2**: インタラクション（1週間）
   - ズーム/パン機能
   - クリック操作
   - キーボード操作

3. **Phase 3**: 視覚効果（1週間）
   - 霧効果
   - アニメーション
   - アイコン/ツールチップ

4. **Phase 4**: 最適化（3日）
   - パフォーマンスチューニング
   - モバイル対応
   - アクセシビリティ

## 次のステップ

1. 設計レビューと承認
2. Phase 1の実装開始（バックエンドAPI）
3. フロントエンドのCanvas基盤構築

この設計により、プレイヤーは探索した世界を視覚的に把握でき、より戦略的な冒険が可能になります。