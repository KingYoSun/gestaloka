# SPシステム（Story Points）仕様

## 概要
SP（ストーリーポイント）は、ゲスタロカにおける中核的なリソースシステムです。表向きは「行動力」として説明されますが、その本質は「世界への干渉力」であり、プレイヤーがどれだけ積極的に物語に関与できるかを表します。

## システムの背景と目的

### 設計理念
- **物語への積極的関与を促進**: SPを消費することで、より深い物語体験が可能
- **持続可能な運営**: LLM APIコストを抽象化し、ゲーム内リソースとして表現
- **公平性の確保**: 無料プレイヤーも基本的な体験を楽しめる設計

### カバーストーリー
ゲーム内では以下のように説明されます：
> 「SPは、あなたが世界に干渉する力を表します。より大きな行動、より複雑な選択には、より多くのSPが必要です。SPは時間と共に回復しますが、急ぐ場合は追加で入手することもできます。」

## SP消費項目と量

### 1. プレイヤー行動

#### 基本行動（0 SP）
- AIが提示する3つの選択肢から選ぶ
- 単純な移動や基本的な会話
- アイテムの使用や装備変更

#### 自由行動宣言（1-5 SP）
- **簡単な行動（1 SP）**: 「扉を蹴破る」「大声で叫ぶ」
- **通常の行動（2 SP）**: 「周囲を詳しく調査する」「NPCと交渉する」
- **複雑な行動（3 SP）**: 「罠を仕掛ける」「複数の行動を組み合わせる」
- **創造的な行動（4 SP）**: 「環境を利用した独創的な解決策」
- **極めて複雑な行動（5 SP）**: 「詳細な計画を立てて実行する」

### 2. ログ派遣

#### 基本消費
- **短期派遣（1-3日）**: 10-30 SP
- **中期派遣（4-7日）**: 40-70 SP
- **長期派遣（8-14日）**: 80-140 SP
- **特別長期（15-30日）**: 150-300 SP

#### 追加消費
- **階層深度**: 追加で階層×2 SP
- **特殊地点**: ダンジョン内部など +10 SP
- **複雑な目的**: 条件の複雑さに応じて +5-20 SP

### 3. 特殊機能

#### ログ強化
- **特殊スキル付与**: 20-50 SP/スキル
- **特別装備付与**: 30-100 SP/アイテム
- **性格特性追加**: 15-30 SP/特性

#### システム機能
- **緊急召還**: 派遣期間の残り日数×5 SP
- **即時回復**: HP/MP全回復 10 SP
- **死亡ペナルティ軽減**: 20 SP

## SP回復と入手方法

### 1. 自然回復
- **基本回復量**: 10 SP/日（毎日午前4時）
- **ログイン継続ボーナス**: 
  - 7日連続: +5 SP
  - 14日連続: +10 SP
  - 30日連続: +20 SP

### 2. 購入オプション

#### 通常購入
| SPパック | 価格 | ボーナス | 1SPあたり |
|---------|-----|---------|----------|
| 100 SP | ¥500 | - | ¥5.0 |
| 300 SP | ¥1,200 | 50 SP (16%) | ¥4.0 |
| 500 SP | ¥2,000 | 100 SP (20%) | ¥3.3 |
| 1,000 SP | ¥3,500 | 300 SP (30%) | ¥2.7 |
| 3,000 SP | ¥8,000 | 1,200 SP (40%) | ¥1.9 |

#### 月額パス
- **ベーシックパス（¥1,000/月）**:
  - 毎日追加20 SP（計600 SP/月）
  - ログ派遣枠+1
  - SP消費10%割引

- **プレミアムパス（¥2,500/月）**:
  - 毎日追加50 SP（計1,500 SP/月）
  - ログ派遣枠+3
  - SP消費20%割引
  - 特別ログスキン

### 3. ゲーム内獲得

#### 実績報酬
- 初回キャラクター作成: 50 SP
- 初回ログ編纂: 30 SP
- 初回ログ派遣: 20 SP
- ストーリーマイルストーン: 10-100 SP

#### ログ成果報酬
- 目的達成度に応じて5-20%還元
- 特別な成果: 追加10-50 SP
- 他プレイヤーからの高評価: 5-10 SP

#### イベント報酬
- デイリーミッション: 5-10 SP
- ウィークリーチャレンジ: 20-50 SP
- 期間限定イベント: 様々

## 無料プレイと課金プレイのバランス

### 無料プレイヤーの体験
- **基本的なゲームプレイ**: 1日10 SPで十分可能
- **ログ派遣**: 3-4日に1回の短期派遣
- **計画的なプレイ**: SPを節約しながら楽しめる
- **イベント参加**: 追加SPを獲得してより積極的に

### 課金プレイヤーの利点
- **頻繁な自由行動**: 創造的なプレイスタイル
- **複数ログの同時派遣**: より豊かな物語体験
- **長期派遣**: 深い物語と大きな報酬
- **ストレスフリー**: SP残量を気にせずプレイ

## 経済設計

### SP価値の目安
- 1時間の充実したプレイ: 約20-30 SP
- 1つの意味のあるログ派遣: 約50-100 SP
- 1ヶ月の活発なプレイ: 約1,000-2,000 SP

### 収益予測
- **無料プレイヤー**: 月額¥0（全体の70%）
- **ライトユーザー**: 月額¥500-1,000（全体の20%）
- **コアユーザー**: 月額¥2,000-5,000（全体の8%）
- **ヘビーユーザー**: 月額¥5,000以上（全体の2%）

## 実装上の考慮事項

### 1. SP管理システム
```python
class SPTransaction(SQLModel, table=True):
    id: str = Field(primary_key=True)
    character_id: str = Field(foreign_key="characters.id")
    amount: int  # 正: 獲得、負: 消費
    transaction_type: SPTransactionType
    description: str
    metadata: dict[str, Any]
    created_at: datetime
```

### 2. 消費最適化
- バッチ処理で複数の小規模行動をまとめる
- キャッシュを活用してAPI呼び出しを削減
- プレイヤーの行動パターンを学習して効率化

### 3. 不正防止
- SP購入の二重課金防止
- 異常な消費パターンの検出
- リファンド処理の適切な管理

## 将来の拡張

### 1. SP効率化アイテム
- 「賢者の石」: SP消費-10%（期間限定）
- 「時の砂時計」: SP自然回復+5/日

### 2. ギルドシステム
- ギルドメンバー間でのSP共有
- ギルドクエストでの大量SP報酬

### 3. シーズナルシステム
- シーズンパスによる段階的SP報酬
- 限定SPパックの販売

## モニタリング指標

### 1. SP経済指標
- 日次SP生成量と消費量
- プレイヤーあたりの平均SP保有量
- SP購入率と購入額分布

### 2. ゲームプレイ指標
- 自由行動の使用率
- ログ派遣の頻度と期間分布
- 無料/課金プレイヤーの行動差異

### 3. 収益指標
- ARPPU（課金ユーザーあたり平均収益）
- 課金転換率
- LTV（顧客生涯価値）