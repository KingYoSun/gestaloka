# AI協調動作プロトコル仕様書

**最終更新日:** 2025/06/16  
**バージョン:** 1.0.0  
**対象システム:** ゲスタロカ GM AI評議会

## 1. 概要

### 1.1 目的
GM AI評議会は6つの専門AIエージェントで構成されており、それぞれが独自の責務を持っています。本プロトコルは、これらのAIエージェントが協調して動作し、一貫性のある豊かなゲーム体験を提供するための仕組みを定義します。

### 1.2 GM AI評議会メンバー
1. **脚本家AI (Dramatist)** - 物語生成とテキスト創作
2. **状態管理AI (State Manager)** - ルール判定とパラメータ管理
3. **歴史家AI (Historian)** - 記録管理と歴史編纂
4. **NPC管理AI (NPC Manager)** - NPC生成と行動制御
5. **世界の意識AI (The World)** - マクロイベント管理
6. **混沌AI (The Anomaly)** - 予測不能イベント生成

### 1.3 協調動作の原則
- **非同期協調**: 各AIは独立して動作しつつ、必要に応じて他のAIと協調
- **情報共有**: SharedContextを通じて必要な情報を共有
- **優先順位**: 緊急度と重要度に基づいて処理順序を決定
- **一貫性**: 複数のAIの出力を統合して矛盾のない結果を生成

## 2. ドキュメント構成

本仕様書は以下のドキュメントで構成されています：

### [アーキテクチャ仕様](./ai_coordination_architecture.md)
- システム全体構成
- コンポーネント詳細
- 協調動作フロー
- データ構造定義

### [協調パターンカタログ](./ai_coordination_patterns.md)
- AIエージェント呼び出しガイドライン
- シーケンシャル協調
- パラレル協調
- リアクティブ協調
- コンセンサス協調

### [実装リファレンス](./ai_coordination_implementation.md)
- Coordinator AIクラス
- BaseAgentの拡張
- イベント定義
- SharedContext実装
- 進捗通知システム

### [運用ガイド](./ai_coordination_operations.md)
- エラーハンドリング戦略
- パフォーマンス最適化
- テスト戦略
- 今後の拡張計画

## 3. クイックリファレンス

### 3.1 基本的な処理フロー
1. プレイヤーアクションの受信
2. Coordinator AIによるアクション解析
3. タスクリスト生成（最適化の核心）
4. 必要最小限のAI呼び出し
5. レスポンス統合
6. プレイヤーへの応答

### 3.2 主要な最適化ポイント
1. **アクションタイプに基づく最小限のAI呼び出し**
2. **並列実行可能なタスクのグループ化**
3. **キャッシングによる重複リクエストの削減**
4. **進捗通知によるユーザー体験の改善**

### 3.3 重要な設計決定
- **LLMリクエスト最適化**: タスクリスト生成による最小限の呼び出し
- **リアルタイム進捗通知**: プレイヤー体験の向上
- **非同期並列処理**: 高速なレスポンス生成
- **イベント駆動**: 動的で予測不能な展開
- **堅牢性**: エラー時のフォールバック
- **拡張性**: 新しいAIエージェントの追加が容易

## 4. まとめ

本AI協調動作プロトコルは、6つのGM AIエージェントが効果的に連携し、プレイヤーに一貫性のある豊かなゲーム体験を提供するための基盤となります。

このプロトコルに基づいて実装を進めることで、ゲスタロカの核となる「動的な物語生成」を効率的に実現します。